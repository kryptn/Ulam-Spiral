<!DOCTYPE html>
<html>
  <head>
    <title>Ulam Spiral</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px;
      }
    </style>
    <script>
      function CoordMapType(tileSize) {
        this.tileSize = tileSize;
      };

      function xhr(resource){
        x = new XMLHttpRequest();
        x.open("GET", resource, false);
        x.send();
        return JSON.parse(x.response);
      };

      CoordMapType.prototype.getTile = function(coord, zoom, ownerDocument){
        var r = xhr("api/position/"+coord.x+"/"+coord.y*-1);
        var div = ownerDocument.createElement('div');
        div.innerHTML = coord + " " + xhr.responseText;
        div.style.width = this.tileSize.width + 'px';
        div.style.height = this.tileSize.height + 'px';
        div style.color = "red";
        div.style.fontSize = '10';
        div.style.borderStyle = 'solid';
        div.style.borderWidth = '1px';
        div.style.borderColor = '#aaaaaa';
        return div;
      };

      var TypeOptions = {
        getTileUrl: function(coord, zoom){
          var r = xhr("api/"+zoom+"/"+coord.x+"/"+coord.y*-1);
          image = "static/" + r.data + ".png";
        },
        tileSize: new google.maps.Size(25,25),
        maxZoom: 2,
        minZoom: 2,
        name: 'Ulam,
      };

      var MapType = new google.maps.ImageMapType(TypeOptions);

      function initialize(){
        var myLatlng = new google.maps.LatLng(0,0);
        var mapOptions = {
          center: myLatlng,
          zoom: 1,
          streetViewControl: false,
          mapTypeControlOptions: {
            mapTypeIds: ['ulam'],
          };
        };

        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        map.mapTypes.set('ulam', MapType);
        map.setMapTypeId('ulam');
        //map.overlayMapTypes.insertAt(0, new CoordMapType(new google.maps.Size(25,25)));
      };

      function asyncLoad(){
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&callback=initialize';
        document.body.appendChild(script);
      };

      window.onload = asyncLoad;  

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>
            
